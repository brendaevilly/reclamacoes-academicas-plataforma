generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// Tabela de Usuários (Alunos)
model Usuario {
  id            Int           @id @default(autoincrement())
  nome          String
  email         String        @unique
  senha         String
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt
  
  // Relações
  reclamacoes   Reclamacao[]
  comentarios   Comentario[]
  likes         Like[]

  @@map("usuarios")
}

// Tabela de Universidades
model Universidade {
  id            Int           @id @default(autoincrement())
  nome          String
  sigla         String        
  campus         String       @unique
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt
  
  // Relações
  reclamacoes   Reclamacao[]

  @@map("universidades")
}

// Tabela de Categorias
model Categoria {
  id            Int           @id @default(autoincrement())
  nome          String        @unique
  descricao     String?
  createdAt     DateTime      @default(now())
  
  // Relações
  reclamacoes   Reclamacao[]

  @@map("categorias")
}

// Tabela de Reclamações
model Reclamacao {
  id                Int           @id @default(autoincrement())
  titulo            String
  descricao         String
  categoriaId       Int
  universidadeId    Int
  alunoId           Int
  createdAt         DateTime      @default(now())
  updatedAt         DateTime      @updatedAt
  
  // Relações
  categoria         Categoria     @relation(fields: [categoriaId], references: [id])
  universidade      Universidade  @relation(fields: [universidadeId], references: [id])
  aluno             Usuario       @relation(fields: [alunoId], references: [id])
  comentarios       Comentario[]
  likes             Like[]

  @@map("reclamacoes")
}

// Tabela de Comentários
model Comentario {
  id                Int           @id @default(autoincrement())
  texto             String
  reclamacaoId      Int
  autorId           Int
  createdAt         DateTime      @default(now())
  updatedAt         DateTime      @updatedAt
  
  // Relações
  reclamacao        Reclamacao    @relation(fields: [reclamacaoId], references: [id], onDelete: Cascade)
  autor             Usuario      @relation(fields: [autorId], references: [id])
  likes             Like[]

  @@map("comentarios")
}

// Tabela de Likes (para reclamações e comentários)
model Like {
  id                Int           @id @default(autoincrement())
  usuarioId         Int
  reclamacaoId      Int?
  comentarioId      Int?
  createdAt         DateTime      @default(now())
  
  // Relações
  usuario           Usuario      @relation(fields: [usuarioId], references: [id], onDelete: Cascade)
  reclamacao        Reclamacao?  @relation(fields: [reclamacaoId], references: [id], onDelete: Cascade)
  comentario        Comentario?  @relation(fields: [comentarioId], references: [id], onDelete: Cascade)

  @@unique([usuarioId, reclamacaoId])
  @@unique([usuarioId, comentarioId])
  @@map("likes")
}
